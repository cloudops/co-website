<!DOCTYPE html>
<html><head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   
   
   
   
   <link rel="stylesheet" as="style" type="text/css" href="/css/style.min.e43764f67f05066711fea169c4000e40d66601508531d3b303c809c380f9d36c.css" integrity="sha256-5Ddk9n8FBmcR/qFpxAAOQNZmAVCFMdOzA8gJw4D502w=" crossorigin="anonymous" media="screen" />
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
    <link rel="icon no-follow" href="/images/favicon.ico" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,600i,700|Open+Sans:400,700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/d8b2e2ddb4.js" crossorigin="anonymous"></script>


    
        <title>CloudOps - CloudStack: Creating advanced networking zone using API</title>
    
</head><body>
            
            
<div class="navbar-card" id="main-nav">
  <nav class="navbar navbar-expand-xl">
    
    <a class="navbar-brand mr-auto" href="/">
      <img src="/images/CO-logo-horizontal.svg" width="230px" alt="CloudOps logo">
    </a>
    <a class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"><i class="fas fa-hamburger"></i></span>
    </a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto list-group list-group-flush">

        <li class="nav-item dropdown">
          <a class="nav-link" href="/solutions" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Solutions</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <div class="row">
              <div class="col-xl-12 nav-main-section">
                <a href="/solutions"><button>Solutions Overview</button></a>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-3 offset-xl-1 col-lg-3 offset-lg-0 solutions-dropdown-items-group">
                <a href="/using-cloud"><h3 class="dropdown-item list-group-item list-group-item-action">Using Cloud</h3></a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/cloud-native-consulting">Cloud Native Consulting</a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/cloud-migration">Cloud Migration</a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/managed-services-augmented-support">Managed Services <br> Augmented Support</a>



              </div>
              <div class="col-xl-3 offset-xl-0 col-lg-3 offset-lg-1 solutions-dropdown-items-group">
                <a href="/delivering-cloud"><h3 class="dropdown-item list-group-item list-group-item-action">Delivering Cloud</h3></a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/delivering-cloud-consulting">Consulting</a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/managed-services-augmented-support">Managed Services <br> Augmented Support</a>
              </div>

              <div class="col-xl-3 offset-xl-0 col-lg-3 offset-lg-1 solutions-dropdown-items-group">
                <a href="/transformations"><h3 class="dropdown-item list-group-item list-group-item-action">Transformations</h3></a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/transformations/#devops-transformation">DevOps Transformation</a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/transformations/#cloudops-transformation">CloudOps Transformation</a>
                <a class="dropdown-item list-group-item list-group-item-action" href="/transformations/#devnetops">DevNetOps Transformation</a>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-3 nav-cta">
                <img src="/images/navbar-arrows.svg">
              </div>
              <div class="col-xl-9 nav-cta horizontal-nav-cta">
                  <a href="/devops-platform-practices-assessment" target="_blank"><h2>Not sure where to start?</h2>
                <p>Your journey with CloudOps begins with a DevOps Platform and Practices Assessment to get an objective status report and recommendations</p><div class="triangle-right">
                    <div class="inner-triangle"></div></a>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-item dropdown" id="training-dropdown-menu">
          <a class="nav-link" href="/training" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Training</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <div class="row solutions-dropdown-row">
              <div class="col-xl-4 col-lg-4 training-dropdown-items-group">
                  <a class="dropdown-item list-group-item list-group-item-action" href="/workshops">
                <img src="/images/nav-workshops.svg" height="70px">
                <h3>Workshops</h3></a>
              </div>
              <div class="col-xl-4 col-lg-4 training-dropdown-items-group">
                  <a class="dropdown-item list-group-item list-group-item-action" href="/experts">
                <img src="/images/nav-experts.svg" height="70px">
                <h3>Our Experts</h3></a>
              </div>
              <div class="col-xl-4 col-lg-4 training-dropdown-items-group">
                  <a class="dropdown-item list-group-item list-group-item-action" href="/workshops-calendar">
                <img src="/images/nav-calendar.svg" height="70px">
                <h3>Calendar</h3></a>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-3 nav-cta">
                <img src="/images/navbar-arrows.svg">
              </div>
              <div class="col-xl-9 nav-cta horizontal-nav-cta">
                <a href="/blog/quiz-are-you-a-kubernetes-unicorn/" target="_blank">
                <h2>Are you a Kubernetes unicorn?</h2>
                <p>Take our quiz to find out</p>
              </a>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-item dropdown reading-dropdown">
          <a class="nav-link" href="/reading" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
            data-reference="parent" data-offset="50%,20" aria-haspopup="true" aria-expanded="false">Reading</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <div class="row">
              <div class="col-xl-3 nav-cta">
                <img src="/images/navbar-arrows.svg">
                <a href="https://cdn2.hubspot.net/hubfs/732832/Gated%20Content/WP_Securing%20Your%20DevOps%20Platform%20Enterprise_2019.pdf" target="_blank">
                <h2>Secure your DevOps platform</h2>
                <p>White paper highlighting how to handle security challenges faced by enterprises</p>
                </a>
              </div>
              <div class="col-xl-9">
                <div class="row solutions-dropdown-row">
                  <div class="col-xl-2 offset-xl-1 col-lg-2 offset-lg-1">
                      <a href="/blog"><img src="/images/nav-blog.svg" height="70px"></a>
                  </div>
                  <div class="col-xl-3 col-lg-3">
                      <a href="/blog"><h3 class="dropdown-item list-group-item list-group-item-action">Blog</h3></a>
                      <a class="dropdown-item list-group-item list-group-item-action" href="#">Blog Posts</a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="#">Community News</a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="#">CloudOps Press</a>
                  </div>
                  <div class="col-xl-2 offset-xl-0 col-lg-2">
                      <a href="/resources"><img src="/images/nav-resources.svg" height="70px"></a>
                  </div>
                  <div class="col-xl-3 col-lg-3">
                    <a href="/resources"><h3 class="dropdown-item list-group-item list-group-item-action">Resources</h3></a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/resources/white-papers/">White Papers</a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/resources/case-studies/">Case Studies</a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/resources/infographics/">Infographics</a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/resources/one-pagers/">One Pagers</a>
                  </div>
                </div>
              </div>
            </div>
        </li>
        <li class="nav-item dropdown company-dropdown">
          <a class="nav-link" href="/company" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
            data-reference="parent" data-offset="50%,20" aria-haspopup="true" aria-expanded="false">Company</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <div class="row">
              <div class="col-xl-3 nav-cta">
                <img src="/images/navbar-arrows.svg">
                <a href="/blog/cloudops-manifesto/" target="_blank">
                <h2>The CloudOps Manifesto</h2>
                <p>11 key success factors we have learned from our adventures in the cloud</p></a>
              </div>
              <div class="col-xl-6 nav-main-section">
                <a href="/why-cloudops"><button>Why choose CloudOps</button></a>
                <div class="row sub-nav-items">
                  <div class="col-xl-3 offset-xl-2 col-lg-3 offset-lg-3">
                    <img src="/images/description-logo.svg" width="70px">
                  </div>
                  <div class="col-xl-6 col-lg-6">
                    <a class="dropdown-item list-group-item list-group-item-action" href="/about-us"><h3>About Us</h3></a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/partners"><h3>Partners</h3></a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/careers"><h3>Careers</h3></a>
                    <a class="dropdown-item list-group-item list-group-item-action" href="/workshops-calendar"><h3>Events Calendar</h3></a>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 nav-cta">
                <img src="/images/navbar-arrows.svg">
                <a href="blog/staff-augmentation-vs-project-based-services-for-devops-and-cloud-projects/">
                <h2>Accelerate your software release cycles</h2>
                <p>Comparing staff augmentation to project-based services for DevOps and cloud projects</p>
                </a>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-item">
          <a href="/contact-us"><button class="btn" type="submit">Contact</button></a>
        </li>
        <li>
          
        </li>
      </ul>
    </div>
  </nav>
</div><div class="container-fluid main-content">
<main class="post">
    <div class="row">
        <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 col-md-10 offset-md-1 col-sm-12 col-xs-12">
            <article>
                <header>
                    <h1>CloudStack: Creating advanced networking zone using API</h1>
                    <div> March 28, 2014 / Pierre-Luc Dion </div>
                </header>
                
                
                
                <img src="/blog/cloudstack-creating-advanced-networking-zone-using-api/CS-logo-sm_hu95fb707b7c77b1f3c19ba0df77bf41be_10102_400x0_resize_box_2.png" />
                
                
                <p>In the process of automating <a title="CloudStack" href="http://cloudstack.apache.org/">CloudStack</a> installation, we’ve been through a challenging part: Creating an Entire Advanced networking Zone from the API. Production and test system that we deploy don’t have building tools such as mavin in order to create zones, pod,networks,… So the usual process is to use the Web UI and follow the “Add Zone” wizard. Well, not anymore!</p>

<p>To create an entire zone using API we are using Ruby with <a href="https://github.com/chipchilders/cloudstack_ruby_client">Chip’s cloudstack_ruby_client</a>. Other API clients can be used such as <a href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/CloudStack+cloudmonkey+CLI">cloudmonkey</a>, the idea is to demonstrate required API calls and their order.</p>

<h2>Overview</h2>

<p>In this scenario we are using XenServer as hypervisor that have a Bond interface named: “bond1”, Storage networking is not used and we also enable local Storage instead of using Shared SAN for the Primary Storage. Virtual Router and VPC’s are enabled Network Service Providers.</p>

<p>So, to create and populate a zone we need to perform following tasks (the order matter, they might be variant but that version as been tested and does work well so far).</p>

<ol><li>Create zone&nbsp; (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/createZone.html">createZone</a>)</li><li>Prepare networks<ol><li>Create physicalnetworks, and define guest VLAN-range (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/createPhysicalNetwork.html">createPhysicalNetwork</a>)</li><li>Assign physical network to traffic type and assign labels. (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/addTrafficType.html">addTrafficType</a>)</li><li>Update network_service_providers (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/updateNetworkServiceProvider.html">updateNetworkServiceProvider</a>)</li><li>Define guest networks vlan range (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/updatePhysicalNetwork.html">updatePhysicalNetwork</a>)</li><li>Define public IP range (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/createVlanIpRange.html">createVlanIpRange</a>)</li></ol></li><li>Create pod (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/createPod.html">createPod</a>)</li><li>Create cluster (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/createCluster.html">createCluster</a>)</li><li>Create secondary storage (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/addSecondaryStorage.html">addSecondaryStorage</a>)</li><li>Create primary storage or enable localstorage into the zone (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/updateZone.html">updateZone</a>)</li><li>add host (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/addHost.html">addHost</a>)</li><li>enable the zone (<a href="https://cloudstack.apache.org/docs/api/apidocs-4.3/root_admin/updateZone.html">updateZone</a>)</li></ol>

<p>Following steps presume that you have <strong>API_KEY</strong> and <strong>SECRET_KEY</strong> of admin and have set `system.vm.use.local.storage` to true.</p>

<h2>let’s roll</h2>

<p>This quick how to consider that you have Ruby installed, more info on installing ruby: <a title="rvm.io" href="http://rvm.io/rvm/install" target="_blank">rvm.io</a></p>

<ol><li>Prepare your ruby:<pre>$ <span style="color:#00f">gem</span> install cloudstack_ruby_client
$ irb
</pre></li><li>Connection to CloudStack:<pre><span style="color:#00f">require</span> <span style="color:#093">'cloudstack_ruby_client'</span><span style="color:#06f;font-style:italic"># cloudstack connection</span>
URL <span style="color:#00f">=</span> <span style="color:#093">'http://IP:8080/client/api/'</span>
APIKEY <span style="color:#00f">=</span> <span style="color:#093">"admin apikey"</span>
SECKEY <span style="color:#00f">=</span> <span style="color:#093">"admin secretkey"</span>
client <span style="color:#00f">=</span> <span style="color:#33f;font-weight:700">CloudstackRubyClient</span>::<span style="color:#33f;font-weight:700">Client</span>.<span style="color:#00f">new</span>(URL, APIKEY, SECKEY, <span style="color:#9700cc">false</span>)
</pre></li><li>Create zone:&nbsp;<pre>zone_conf <span style="color:#00f">=</span> {
    <span style="color:#6782d3">:dns1</span> =&gt; <span style="color:#093">"8.8.8.8"</span>,
    <span style="color:#6782d3">:internaldns1</span> =&gt; <span style="color:#093">"8.8.8.8"</span>,
    <span style="color:#6782d3">:name</span> =&gt; <span style="color:#093">"testZone2"</span>,
    <span style="color:#6782d3">:guestcidraddress</span> =&gt; <span style="color:#093">"10.2.1.0/24"</span>,
    <span style="color:#6782d3">:networktype</span> =&gt; <span style="color:#093">"Advanced"</span>
}
zone <span style="color:#00f">=</span> client.create_zone(zone_conf)
</pre></li><li>Configure network:<ol><li>physical interface mapping</li><li>define guest VLANs</li><li>define public IP’s range</li><li>Enable network service providers</li></ol><pre>phy_net_conf <span style="color:#00f">=</span> {
    <span style="color:#6782d3">:name</span> =&gt;<span style="color:#093">"data2"</span>, 
    <span style="color:#6782d3">:isolationmethods</span> =&gt; <span style="color:#093">"VLAN"</span>,
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
}
p_net <span style="color:#00f">=</span> client.create_physical_network(phy_net_conf)

phy_net <span style="color:#00f">=</span> client.list_physical_networks(<span style="color:#6782d3">:name</span> =&gt; phy_net_conf[<span style="color:#6782d3">:name</span>])

client.add_traffic_type({ 
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:traffictype</span> =&gt; <span style="color:#093">"Management"</span>, 
    <span style="color:#6782d3">:xennetworklabel</span> =&gt; <span style="color:#093">"bond1"</span>
})
client.add_traffic_type({ 
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:traffictype</span> =&gt; <span style="color:#093">"Public"</span>, 
    <span style="color:#6782d3">:xennetworklabel</span> =&gt; <span style="color:#093">"bond1"</span>
})
client.add_traffic_type({ 
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:traffictype</span> =&gt; <span style="color:#093">"Guest"</span>, 
    <span style="color:#6782d3">:xennetworklabel</span> =&gt; <span style="color:#093">"bond1"</span>
})

<span style="color:#06f;font-style:italic"># cannot enable phy_network at creation.</span>
guest_vlan_range <span style="color:#00f">=</span> client.update_physical_network({
    <span style="color:#6782d3">:id</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:state</span> =&gt; <span style="color:#093">"Enabled"</span>,
    <span style="color:#6782d3">:vlan</span> =&gt; <span style="color:#093">"3101-3110"</span>,
    <span style="color:#6782d3">:isolationmethods</span> =&gt; <span style="color:#093">"VLAN"</span>, 
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
})

public_range <span style="color:#00f">=</span> client.create_vlan_ip_range({
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:startip</span> =&gt; <span style="color:#093">"172.12.1.80"</span>, 
    <span style="color:#6782d3">:endip</span> =&gt; <span style="color:#093">"172.12.1.89"</span>, 
    <span style="color:#6782d3">:netmask</span> =&gt; <span style="color:#093">"255.255.255.0"</span>,
    <span style="color:#6782d3">:gateway</span> =&gt; <span style="color:#093">"172.12.1.1"</span>,
    <span style="color:#6782d3">:vlan</span> =&gt; <span style="color:#093">"1161"</span>,
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
})

<span style="color:#06f;font-style:italic">##</span>
<span style="color:#06f;font-style:italic"># Service Providers</span>
<span style="color:#06f;font-style:italic">#</span>
<span style="color:#06f;font-style:italic"># enable vr-element  =&gt; need loop</span>
vre <span style="color:#00f">=</span> client.list_virtual_router_elements(<span style="color:#6782d3">:enabled</span> =&gt; <span style="color:#093">"false"</span>)[<span style="color:#093">"virtualrouterelement"</span>]
vre.each <span style="color:#00f">do </span>|vre|
    client.configure_virtual_router_element({
        <span style="color:#6782d3">:id</span> =&gt; vre[<span style="color:#093">"id"</span>],
        <span style="color:#6782d3">:enabled</span> =&gt; <span style="color:#093">"true"</span>
    })
<span style="color:#00f">end</span>
vr_prov <span style="color:#00f">=</span> client.list_network_service_providers(
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:name</span> =&gt; <span style="color:#093">"VirtualRouter"</span>
)
vpc_prov <span style="color:#00f">=</span> client.list_network_service_providers(
    <span style="color:#6782d3">:physicalnetworkid</span> =&gt; phy_net[<span style="color:#093">"physicalnetwork"</span>].first[<span style="color:#093">"id"</span>], 
    <span style="color:#6782d3">:name</span> =&gt; <span style="color:#093">"VpcVirtualRouter"</span>
)

<span style="color:#06f;font-style:italic"># enable network service providers</span>
client.update_network_service_provider({
    <span style="color:#6782d3">:id</span> =&gt; vr_prov[<span style="color:#093">"networkserviceprovider"</span>].first[<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:state</span> =&gt; <span style="color:#093">"Enabled"</span>
})
client.update_network_service_provider({
    <span style="color:#6782d3">:id</span> =&gt; vpc_prov[<span style="color:#093">"networkserviceprovider"</span>].first[<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:state</span> =&gt; <span style="color:#093">"Enabled"</span>
})
<span style="color:#06f;font-style:italic">#</span>
<span style="color:#06f;font-style:italic">##</span>
</pre></li><li>Create everything else for the zone:<pre><span style="color:#06f;font-style:italic"># create POD</span>
pod_conf <span style="color:#00f">=</span> {
    <span style="color:#6782d3">:name</span> =&gt; <span style="color:#093">"pod1"</span>,
    <span style="color:#6782d3">:gateway</span> =&gt; <span style="color:#093">"172.30.20.1"</span>,
    <span style="color:#6782d3">:netmask</span> =&gt; <span style="color:#093">"255.255.255.0"</span>,
    <span style="color:#6782d3">:startip</span> =&gt; <span style="color:#093">"172.16.20.80"</span>,
    <span style="color:#6782d3">:endip</span> =&gt; <span style="color:#093">"172.30.20.89"</span>,
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
}
pod <span style="color:#00f">=</span> client.create_pod(pod_conf)<span style="color:#06f;font-style:italic"># create CLUSTER</span>
cluster_conf <span style="color:#00f">=</span> {
    <span style="color:#6782d3">:clustername</span> =&gt; <span style="color:#093">"cluster1"</span>,
    <span style="color:#6782d3">:clustertype</span> =&gt; <span style="color:#093">"CloudManaged"</span>,
    <span style="color:#6782d3">:hypervisor</span> =&gt; <span style="color:#093">"XenServer"</span>,
    <span style="color:#6782d3">:podid</span> =&gt; pod[<span style="color:#093">"pod"</span>][<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
}
cluster <span style="color:#00f">=</span> client.add_cluster (cluster_conf)<span style="color:#06f;font-style:italic"># create secondary storage</span>
sec <span style="color:#00f">=</span> client.add_secondary_storage ({
    <span style="color:#6782d3">:url</span> =&gt; <span style="color:#093">"nfs://172.30.21.173/data/secondary"</span>,
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>]
})<span style="color:#06f;font-style:italic"># enable local storage</span>
client.update_zone({<span style="color:#6782d3">:id</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>], <span style="color:#6782d3">:localstorageenabled</span> =&gt; <span style="color:#093">"true"</span>})<span style="color:#06f;font-style:italic"># add host that is ready to go</span>
host_conf <span style="color:#00f">=</span> {
    <span style="color:#6782d3">:hypervisor</span> =&gt; <span style="color:#093">"XenServer"</span>,
    <span style="color:#6782d3">:url</span> =&gt; <span style="color:#093">"http://172.30.20.34"</span>,
    <span style="color:#6782d3">:username</span> =&gt; <span style="color:#093">"root"</span>,
    <span style="color:#6782d3">:password</span> =&gt; <span style="color:#093">"ROOT_PASSORD"</span>,
    <span style="color:#6782d3">:clusterid</span> =&gt; cluster[<span style="color:#093">"cluster"</span>].first[<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:zoneid</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>],
    <span style="color:#6782d3">:podid</span> =&gt; pod[<span style="color:#093">"pod"</span>][<span style="color:#093">"id"</span>]
}
host <span style="color:#00f">=</span> client.add_host(host_conf)
</pre></li><li>Finaly, enable the zone:<pre><span style="color:#06f;font-style:italic"># enable zone</span>
client.update_zone({<span style="color:#6782d3">:id</span> =&gt; zone[<span style="color:#093">"zone"</span>][<span style="color:#093">"id"</span>], <span style="color:#6782d3">:allocationstate</span> =&gt; <span style="color:#093">"Enabled"</span>})
</pre></li></ol>

            </article>
        </div>
    </div>


    <div class="row nav-buttons back-foward in-content">
        <div
            class="col-xl-4 offset-xl-2 col-lg-5 offset-lg-1 col-md-5 offset-md-1 col-sm-5 offset-sm-1 col-xs-2 back-button">
            
            <a href="/blog/install-apache-cloudstack-with-chef/"><button class="btn">
                    <div class="triangle-left">
                        <div class="inner-left-triangle"></div>
                    </div>Previous Post
                </button></a>
            
        </div>
        <div class="col-xl-4 col-lg-5 col-md-5 col-sm-5 col-xs-2 foward-button">
                
            <a href="/blog/clouds-are-like-airlines/">
                <button class="btn">
                    Next Post<div class="triangle-right">
                        <div class="inner-triangle"></div>
                    </div>
                </button></a>
                
        </div>
    </div>

    <div class="social">
        

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 36px; fill: #005D91; margin-top: 0;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.facebook > svg {height: 30px; margin: auto 5px;}
#share-buttons > div.twitter > svg {height: 30px; margin: auto 5px;}
#share-buttons > div.linkedin > svg {height: 30px; margin: auto 5px;}
#share-buttons > div.mail > svg {height: 30px; margin: auto 5px;}
</style>

<div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=\/blog\/cloudstack-creating-advanced-networking-zone-using-api\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=\/blog\/cloudstack-creating-advanced-networking-zone-using-api\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=\/blog\/cloudstack-creating-advanced-networking-zone-using-api\/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=\/blog\/cloudstack-creating-advanced-networking-zone-using-api\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>

        <i class="far fa-copy copy-page-link"></i>
    </div>

    

    <div class="contact-us-card general-stylings-more-content">
            <div class="row">
                <div class="col-xl-8 offset-xl-2 col-lg-8 offset-lg-2 col-md-10 offset-md-1 col-sm-12 col-xs-12 cta-cards">
                    <div class="card-deck">
                        <div class="card">
                            <a
                                href="https://cdn2.hubspot.net/hubfs/732832/CloudOps%20White%20Paper%20-%20A%20PreFlight%20Checklist%20for%20Cloud%20Migration.pdf">
                                <div class="card-body">
                                    <h3 class="card-title">A checklist for your cloud migration</h3>
                                    <p class="card-text">Download the white paper to get a step by step guide to a successful migration strategy.</p>
                                </div>
                                <div class="corner-triangle"></div>
                            </a>
                        </div>
                        <div class="card">
                            <a
                                href="/blog/the-cloudops-delivery-model-accelerated-value-delivery-through-code-and-collaboration">
                                <div class="card-body">
                                    <h3 class="card-title"> Accelerated value delivery</h3>
                                    <p class="card-text">Read more on how to maximize value through our unique delivery model.</p>
                                    <div class="corner-triangle"></div>
                            </a>
                        </div>
                    </div>
                    <div class="card">
                        <a href="https://cdn2.hubspot.net/hubfs/732832/Cloud-Ops_Cloud-Migration_v3.pdf">
                            <div class="card-body">
                                <h3 class="card-title">Cloud migration one-pager</h3>
                                <p class="card-text">
                                    Everything you need to know about how our services can help get your cloud journey started.
                                    <div class="corner-triangle"></div>
                            </div>
                        </a>
                    </div>
                    <div class="card">
                        <a href="/contact-us">
                            <div class="card-body">
                                <h3 class="card-title">Networking is the hardest part</h3>
                                <p class="card-text">Contact us to learn more about our hardware and software-defined networking solutions.</p>
                                <div class="corner-triangle"></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

        </div><div class="footer">
    <div class="row no-gutters logo">
        <div class="col-sm-12">
            <a href="/"><img class="cloudops-logo" src="/images/cO-logo-horizontal.png"
                    height="45px" width="auto"></a>
        </div>
    </div>

    <div class="row no-gutters footer-content">
        <div class="col-xl-3 offset-xl-2 col-lg-3 offset-lg-0 col-md-12">

            <a href="https://twitter.com/CloudOps_" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="https://www.linkedin.com/company/cloudops" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://www.facebook.com/Cloud0ps/" target="_blank"><i class="fab fa-facebook-f"></i></a>
            <h5>Newsletter Signup</h5>
            <div class="newsletter-form">
                    <div class="newsletter-form">

<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "732832",
	formId: "25575fb9-f01b-43a6-b9cd-2c154efad9f4"
});
</script>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-12 col-sm-12 footer-nav">
            <h6>Services</h6>
            <ul>
                <li><a href="/cloud-native-consulting">Cloud Native Consulting</a></li>
                <li><a href="/transformations">Transformations</a></li>
                <li><a href="/managed-services-augmented-support">Support</a></li>
                <li><a href="/delivering-cloud">Cloud Delivery</a></li>
            </ul>
        </div>

        <div class="col-xl-2 col-lg-3 col-md-12 footer-nav">
            <h6>Learning</h6>
            <ul>
                <li><a href="/workshops">Workshops</a></li>
                <li><a href="/blog/blog-posts">Blog</a></li>
                <li><a href="/resources/white-papers">White Papers</a></li>
                <li><a href="/resources/case-studies">Case Studies</a></li>
            </ul>
        </div>

        <div class="col-xl-2 col-lg-3 col-md-12 footer-nav">
            <h6>Company</h6>
            <ul>
                <li><a href="/about-us">About Us</a></li>
                <li><a href="/careers">Careers</a></li>
                <li><a href="/partners">Partners</a></li>
                <li><a href="/why-cloudops">Why Cloudops</a></li>
            </ul>
        </div>
    </div>

    <div class="row no-gutters copyright">
        <div class="col-sm-12">
            <p>&copy; CloudOps. All rights Reserved. // <a href="/privacy-policy">Privacy Policy</a></p>
        </div>
    </div>
</div>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
        <script src="/js/main.js"></script>

        </body>
</html>